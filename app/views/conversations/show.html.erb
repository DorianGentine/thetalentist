<%= render "shared/navbar" %>


<div class="fenetre-ecran">


  <div class="colonne col-gauche bordure-droite">
    <div class="premiere-ligne">
      <h4>MESSAGERIE</h4>
    </div>
    <div class="index-talents">
      <%  @conversations.each do |conversation| %>

        <!-- div connexion pas encore accepté -->


        <!-- div connexion accepté -->
          <%= link_to conversation_path(conversation) do %>
            <% parti = conversation.participants - [current_user] %><%= parti[0].firstname %> <br>
            <%= truncate(conversation.messages.last.body, length: 20) %> <br>
          <% end %>



      <% end %>
    </div>
  </div>

  <div class="colonne col-centre bordure-droite">
    <div class="premiere-ligne nom-discussion">
      <!-- div Prénom Nom et poste  -->
      <% if @participant[0].is_a?(Headhunter) %>
        <h2><%= @participant[0].firstname.capitalize %> de <%= @participant[0].startup.name.capitalize %></h2>
        <p> <%= @participant[0].job.capitalize %> </p>
      <% elsif @participant[0].is_a?(Talent)%>
        <h2><%= @participant[0].firstname.capitalize %> <%= @participant[0].name.capitalize %></h2>
        <p> <%= @participant[0].experiences.last.position.capitalize %> </p>

      <% else %>
        <h2><%= @participant[0].firstname.capitalize %> <%= @participant[0].name.capitalize %></h2>
        <p> Chargé digitale TODO </p>
      <% end %>
    </div>
    <div class="conversation">

      <!-- div link vers profil -->
      <% if @participant[0].is_a?(Headhunter) %>
        <%= link_to headhunter_path(@participant[0]) do %>
          <p>Vous pouvez accéder au profil de <%= @participant[0].startup.name.capitalize %></p>
          <p>Visiter le profil > </p>
        <% end %>
      <% elsif @participant[0].is_a?(Talent)%>
        <%= link_to headhunter_path(@participant[0]) do %>
          <p>Vous pouvez accéder au profil de <%= @participant[0].firstname.capitalize %></p>
          <p>Visiter le profil > </p>
        <% end %>
      <% else %>

      <% end %>


      <!-- div conversation -->
      <% @conversation.receipts_for(current_user).each do |receipt| %>
        <div class="message">
          <% if receipt.message.sender.photo %>
            <%= image_tag receipt.message.sender.photo, :transformation=>[ :gravity=>"face"] %>
          <% else %>
            <p><%= receipt.message.sender.firstname.split(//).first.upcase %>
             <!--  <#%= receipt.message.sender.name.split(//).first.upcase %> --></p>
          <% end %>
          <p><%= receipt.message.sender.firstname %> commented:</p>
          <p><%= receipt.message.body %></p>
        </div>
      <% end %>
    </div>
    <div class="boite-envoi">
      <%= form_tag conversation_messages_path(@conversation), method: :post do %>
        <%= text_area_tag :body %>
        <%= submit_tag %>
      <% end %>
    </div>

    <!-- div accepter la relation -->

    <% if current_user.is_a?(Talent) %>
      <% if current_talent.relationships.last.status == "pending"  %>
        <%= simple_form_for current_talent, methode: :get do |f| %>
          <%= f.simple_fields_for :relationships do |u| %>
            <%= u.button :submit, inline_label: "Accepter" %>
            <%= u.button :submit, inline_label: "Refuser" %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

  </div>

  <div class="colonne col-droite">
    <div class="premiere-ligne">
      <h4>Documents échangés</h4>
    </div>
    <div class="doc-echanges"></div>
  </div>


</div>













